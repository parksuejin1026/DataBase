# 데이터베이스 기초와 SQL (5장) - SQL (1)

## 1. SQL 언어 개요

* **SQL (Structured Query Language) 개요**
    * 관계형 데이터베이스의 인기 비결 중 하나.
    * 4장에서 배운 **관계 대수 이론**을 실제 사용할 수 있도록 구현한 언어.
    * **표준화**된 언어이며 대부분의 DBMS 제품에서 실행 가능.
    * 최초는 IBM 연구소에서 개발된 **SEQUEL**이었으며, 이후 **SQL**로 이름이 변경됨.
    * 1986년 ANSI에 의해 처음 표준 문법 제시, 가장 최근 표준은 2019년에 ANSI와 ISO에 의해 제정.
    * 읽는 법: '에스큐엘' 또는 '시퀄'.

* **SQL 언어의 구성 (SQL문의 분류)**
    * **데이터 정의어 (DDL; Data Definition Language)**: 데이터베이스의 **구조**를 정의하는 데 사용.
        * `CREATE`: 데이터베이스 및 테이블, 뷰, 인덱스 등 **개체를 정의**한다.
        * `ALTER`: 데이터베이스 및 개체의 정의를 **변경**한다.
        * `DROP`: 데이터베이스 및 개체를 **삭제**한다.
    * **데이터 조작어 (DML; Data Manipulation Language)**: 테이블에 데이터를 **입력, 수정, 삭제, 조회**할 때 사용.
        * `INSERT`: 테이블에 새로운 데이터(튜플)를 **추가**한다.
        * `UPDATE`: 테이블에 저장된 데이터를 **수정**한다.
        * `DELETE`: 테이블에 저장된 데이터(튜플)를 **삭제**한다.
        * `SELECT`: 테이블에 저장된 데이터를 조건에 맞게 **조회**한다.
    * **데이터 제어어 (DCL; Data Control Language)**: 보안을 위해 접근 권한 및 사용 권한을 부여하거나 회수할 때 사용.
        * `GRANT`: 접근/사용 권한을 **부여**한다.
        * `REVOKE`: 접근/사용 권한을 **회수**한다.
    * **그 밖의 명령어**:
        * 트랜잭션 관련: `COMMIT`, `ROLLBACK`
        * PL/SQL 관련: `DECLARE`, `BEGIN`, `END`, `SET`

* **SQL 언어의 특징**
    * **대소문자 미구분**: SQL 명령어, 테이블 이름, 속성 이름 등은 **대소문자를 구분하지 않는다** (`SELECT`, `select`는 같음).
    * **문자열 값 비교 시 대소문자 구분**: 테이블 안에 저장된 **문자열 값**을 비교할 때는 대소문자를 구분한다 (`'SMITH'`와 `'smith'`는 다름).
    * **작성 형태**: 한 줄 또는 여러 줄에 걸쳐서 작성이 가능하다.
    * **명령문의 끝**: SQL 문 뒤에는 **세미콜론(;)**을 붙여 명령문의 끝을 의미하거나 명령문과 명령문을 구분한다.

## 2. 예제 데이터베이스 소개 (emppdb)

* **포함 테이블**: `dept` (부서), `emp` (사원)
* **`dept` (부서) 테이블 컬럼**
    * `deptno` (숫자): 부서번호 (**기본키**)
    * `dname` (문자): 부서명
    * `loc` (문자): 부서위치
* **`emp` (사원) 테이블 컬럼**
    * `empno` (숫자): 사원번호 (**기본키**)
    * `ename` (문자): 사원명
    * `job` (문자): 담당업무
    * `mgr` (숫자): 매니저 (직속상사)
    * `hiredate` (날짜): 입사일자
    * `sal` (숫자): 급여(연봉)
    * `comm` (숫자): 커미션(보너스)
    * `deptno` (숫자): 부서번호 (**외래키**)
* **참조 관계**:
    * `emp.mgr`은 `emp.empno`를 참조한다.
    * `emp.deptno`는 `dept.deptno`를 참조한다.

## 3. SELECT 문

* **SELECT 문 개요**: 테이블에 저장된 데이터를 **조회**할 때 사용하는 가장 많이 사용되는 DML 명령어.
* **SELECT 문의 기본 구조**
    ```sql
    SELECT 컬럼명1, 컬럼명2, ..
    FROM 테이블명
    [WHERE 검색조건]; -- WHERE절은 생략 가능
    ```
    * **SELECT절**: 조회를 원하는 컬럼명 서술 (여러 개일 경우 콤마로 구분).
    * **FROM절**: 데이터가 저장되어 있는 테이블 명을 서술.
    * **WHERE절**: 원하는 **행(튜플)**들만 추출하기 위한 검색 조건을 서술 (생략 시 모든 행 반환).
    * **SELECT문 작성 절차**: ① FROM 테이블명 → ② SELECT 컬럼명 → ③ WHERE 검색조건

* **DISTINCT 와 \* 연산자**
    * `DISTINCT`: 질의 결과에서 **중복 제거** (ex: `SELECT DISTINCT job FROM emp;`).
    * `*`: 테이블의 **모든 컬럼**을 의미 (ex: `SELECT * FROM emp;`).

* **WHERE 절에서 검색 조건 작성**
    | 연산자 | 설명 |
    | :--- | :--- |
    | **비교 연산자** | $=, <>, >, >=, <, <=$ |
    | **논리 연산자** | `AND` (모두 만족), `OR` (하나라도 만족), `NOT` (만족하지 않는 튜플 검색) |
    | **다수의 값 비교** | `BETWEEN A AND B` (A와 B를 포함한 범위), `NOT BETWEEN A AND B` |
    | | `IN (...)` (지정된 목록 안에 있는지), `NOT IN (...)` (지정된 목록 밖에 있는지) |
    | **NULL 값 비교** | `IS NULL` (널인지 비교), `IS NOT NULL` (널이 아닌지 비교) |
    | **문자 부분 비교** | `LIKE` (지정한 문자열 포함 여부 비교) |
    | | `%` (임의의 개수의 문자를 표현), `_` (하나의 문자를 표현) |

    * **NULL 값의 특징**: 널 값은 크기를 갖지 않으므로 일반 비교 연산자(>, =, < 등)를 사용할 수 없다. `IS NULL` 또는 `IS NOT NULL`을 사용해야 한다.
    * **문자열 비교 주의**: 오라클에서는 문자열 값 비교 시 **대소문자를 구분**한다 (ex: `dname = 'SALES'` 와 `dname = 'sales'`는 다름).

## 4. 내장 함수의 사용

* **내장 함수 (집계 함수)**: SELECT 문 안에 함께 사용할 수 있는 함수.
    | 함수명 | 설명 | 비고 |
    | :--- | :--- | :--- |
    | `COUNT()` | 조회 결과에서 튜플의 **개수**를 반환 | `COUNT(*)`가 가장 안전함. NULL을 포함하는 컬럼은 개수 셀 때 제외됨. |
    | `MAX()` | 특정 숫자 컬럼의 **최대 값**을 반환 | |
    | `MIN()` | 특정 숫자 컬럼의 **최소 값**을 반환 | |
    | `AVG()` | 특정 숫자 컬럼의 **평균 값**을 반환 | NULL이 포함된 튜플은 평균 계산에서 제외됨. |
    | `SUM()` | 특정 숫자 컬럼의 **합계 값**을 반환 | |

* **컬럼 이름 변경**: `SELECT 컬럼명 AS 새컬럼명` 형태로 질의 결과에 나오는 컬럼 이름을 바꿀 수 있다 (ex: `SELECT COUNT(*) AS cnt_salesman`).
* **숫자 컬럼 산술 연산**: 숫자 타입의 컬럼에 대해 산술 연산 (`+`, `-`, `*`, `/` 등)이 가능하다.
    * **주의**: **숫자 + NULL은 결과가 NULL**이 된다.

## 5. 정렬, 그룹

* **정렬 (ORDER BY)**
    * 질의 결과를 주어진 기준에 따라 튜플들을 **정렬**하여 보여주는 기능.
    * `ORDER BY` 키워드를 **WHERE 절 다음에** 서술한다.
    * **기본 정렬**: **오름차순** (`ASC`, 생략 가능).
    * **내림차순**: `DESC`를 붙인다.
    * **복수 컬럼 정렬**: 콤마로 구분하여 여러 컬럼을 지정할 수 있으며, 먼저 지정된 컬럼 순으로 정렬된다 (ex: `ORDER BY deptno, ename`).
    * **주의**: 질의 결과의 정렬은 실제 테이블에는 영향을 미치지 않는다.

* **그룹 (GROUP BY)**
    * 질의 결과를 특정 기준으로 **그룹**으로 묶어서 보고 싶을 때 사용 (ex: 부서별 사원 수).
    * `GROUP BY` 다음에 그룹을 묶을 컬럼을 명시한다.
    * **SELECT 절에 올 수 있는 컬럼**:
        1.  `GROUP BY`에 사용한 컬럼.
        2.  `COUNT()`, `MAX()`, `MIN()` 등 **집계 함수**를 적용한 컬럼.
        3.  *그 외 컬럼을 사용하면 오류 발생 (`ORA-00979`).*

* **그룹 결과에 조건 지정 (HAVING)**
    * `GROUP BY`에 의해 만들어진 **그룹 결과**에 조건을 지정하여 필터링할 때 사용.
    * 사용 키워드는 `HAVING`이다.
    * **비교**:
        * **`WHERE`**: 테이블의 **전체 튜플**에 적용되는 검색 조건.
        * **`HAVING`**: `GROUP BY`에 의해 만들어진 **그룹 결과**에 적용되는 검색 조건.
    * **작성 순서**: `SELECT` → `FROM` → `WHERE` (생략 가능) → **`GROUP BY`** → **`HAVING`** (생략 가능) → `ORDER BY` (생략 가능).
